openapi: 3.0.0
info:
  title: CI/CD Scan Trigger API
  version: 1.0.2
  description: REST API for triggering Jenkins scan jobs and retrieving custom job detail

servers:
  - url: http://localhost:8000

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Token

  schemas:
    TriggerScanRequest:
      type: object
      properties:
        pipeline_name:
          type: string
        parameters:
          type: object
          additionalProperties:
            type: string

    TriggerScanResponse:
      type: object
      additionalProperties: true

    CallbackRequest:
      type: object
      properties:
        job_id:
          type: string
        pipeline_name:
          type: string
        result:
          type: object
          additionalProperties: true

    SimpleResponse:
      type: object
      properties:
        message:
          type: string

    JobDetailResponse:
      type: object
      additionalProperties: true

security:
  - ApiKeyAuth: []

paths:
  /api/scan/trigger:
    post:
      summary: Trigger a Jenkins scan job
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TriggerScanRequest'
      responses:
        200:
          description: Scan job triggered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TriggerScanResponse'
      security:
        - ApiKeyAuth: []

  /api/scan/callback:
    post:
      summary: Jenkins callback to deliver scan results
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CallbackRequest'
      responses:
        200:
          description: Result saved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleResponse'
      security:
        - ApiKeyAuth: []

  /api/scan/{job_id}/detail:
    get:
      summary: Get detailed scan job info including status, logs, and results
      parameters:
        - in: path
          name: job_id
          required: true
          schema:
            type: string
      responses:
        200:
          description: Job detail returned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobDetailResponse'
      security:
        - ApiKeyAuth: []
